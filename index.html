<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ë™ì‚¬ ë³€í˜• í•™ìŠµ & 4ì§€ì„ ë‹¤ í€´ì¦ˆ</title>
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --panel:#1f2937; --text:#e5e7eb; --muted:#9ca3af;
      --blue:#3b82f6; --green:#22c55e; --red:#ef4444; --amber:#f59e0b;
      --radius:16px; --shadow:0 6px 18px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box;}
    body{margin:0; font-family:"Noto Sans KR",system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
      background:var(--bg); color:var(--text); min-height:100vh; display:flex; align-items:center; justify-content:center;}
    .app{width:min(1000px,94vw); height:min(760px,94vh); display:grid; gap:12px; grid-template-rows:auto auto 1fr auto;}
    .topbar{display:flex; justify-content:space-between; align-items:center;}
    .brand{font-weight:800; font-size:20px;}
    .stats{font-size:14px; color:var(--muted);}
    .panel{background:var(--panel); border-radius:var(--radius); box-shadow:var(--shadow); padding:12px;}
    .controls{display:grid; grid-template-columns:repeat(6,1fr); gap:8px;}
    .controls label{font-size:12px; color:var(--muted);}
    .controls select,.controls input[type="range"],.controls input[type="checkbox"]{width:100%; background:#0b1220; color:var(--text); border:1px solid #263247; border-radius:10px; padding:6px;}
    .progress{display:flex; align-items:center; gap:10px; margin-top:10px;}
    .bar{flex:1; height:12px; background:#0b1220; border:1px solid #263247; border-radius:999px; overflow:hidden;}
    .bar>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,#2563eb,#22c55e);}
    .screens{display:flex; gap:12px;}
    .card{flex:1; background:var(--card); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow); text-align:center;}
    .prompt-tag{font-size:12px; color:var(--muted); border:1px dashed #334155; padding:2px 8px; border-radius:999px; margin-bottom:8px; display:inline-block;}
    .word-big{font-size:56px; font-weight:900; margin:8px 0 6px; line-height:1.05;}
    .mean{margin-top:6px; font-size:22px; color:#e2e8f0;}
    .triple{display:flex; gap:10px; justify-content:center; margin:10px 0; flex-wrap:wrap;}
    .pill{padding:10px 16px; border-radius:999px; background:#0b1220; border:1px solid #2a3650; font-weight:800; font-size:20px;}
    .pill.hl{outline:2px solid var(--blue);}
    .btn{border:0; border-radius:14px; padding:12px 16px; font-weight:700; cursor:pointer; background:var(--blue); color:white;}
    .btn.secondary{background:#0b1220; color:var(--text); border:1px solid #2a3650;}
    .btn.warn{background:var(--amber);}
    .btn.ghost{background:transparent; border:1px dashed #334155; color:var(--muted);}
    .right{width:320px; background:var(--card); border-radius:var(--radius); padding:14px; display:flex; flex-direction:column; gap:12px;}
    .chip{font-size:12px; color:#d1d5db; padding:6px 10px; border-radius:999px; background:#0b1220; border:1px solid #2a3650; cursor:pointer;}
    .small{font-size:12px; color:var(--muted);}
    .qopts{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;}
    .opt{background:#0b1220; border:1px solid #2a3650; border-radius:14px; padding:14px; cursor:pointer; text-align:left;}
    .opt .t{font-size:18px; font-weight:800;}
    .footer{display:flex; justify-content:space-between; align-items:center;}
    .row{display:flex; gap:8px; flex-wrap:wrap;}
    .hidden{display:none !important;}
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.5);}
    .modal.show{display:flex;}
    .modal .box{background:var(--panel); border-radius:20px; padding:20px; width:min(560px,92vw);}
    @media (max-width:960px){ .screens{flex-direction:column;} .right{width:100%; order:2} .card{order:1} }
  </style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="brand">ë™ì‚¬ ë³€í˜• í•™ìŠµ Â· 4ì§€ì„ ë‹¤ í€´ì¦ˆ</div>
    <div class="stats">
      ğŸ”Š <label><input type="checkbox" id="mute"/> ìŒì†Œê±°</label> Â·
      ì •ë‹µ <span id="ok">0</span> Â· ì˜¤ë‹µ <span id="no">0</span> Â· ë‚¨ì€ <span id="left">0</span> Â·
      ì„¸íŠ¸ <span id="setIdx">1</span>/<span id="setTotal">1</span>
    </div>
  </div>

  <div class="panel">
    <div class="controls">
      <div><label>ëª¨ë“œ</label>
        <select id="mode"><option value="study">í•™ìŠµ</option><option value="quiz">í€´ì¦ˆ</option></select>
      </div>
      <div><label>ì„¸íŠ¸ í¬ê¸°</label>
        <select id="setSize">
          <option value="10">10</option><option value="20" selected>20</option><option value="30">30</option><option value="40">40</option>
        </select>
      </div>
      <div><label>ì†ë„</label>
        <input type="range" id="rate" min="0.8" max="1.2" step="0.05" value="1.0"/>
      </div>
      <div><label><input type="checkbox" id="autoNext"/> ìë™ ë‹¤ìŒ</label></div>
      <div></div><div></div>
    </div>
    <div class="progress"><div class="bar"><i id="bar"></i></div><div class="small"><span id="progTxt">0/0</span></div></div>
  </div>

  <div class="screens">
    <div class="card">
      <div class="prompt-tag" id="promptTag">í•™ìŠµ ì¹´ë“œ</div>
      <div id="screenStudy">
        <div class="word-big" id="bWord">ready?</div>
        <div class="mean" id="krMeaning">ëœ»: -</div>
        <div class="triple">
          <span class="pill" id="pBase">base</span>
          <span class="pill" id="pPast">past</span>
          <span class="pill" id="pPP">pp</span>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="btnPlay">â–¶ ì½ê¸°</button>
          <button class="btn secondary" id="btnRepeat">âŸ³ ë°˜ë³µ+ìë™</button>
          <button class="btn secondary" id="btnStop">â—¼ ì •ì§€</button>
          <button class="btn warn" id="btnNext">ë‹¤ìŒ</button>
          <button class="btn ghost" id="btnPrev">ì´ì „</button>
        </div>
      </div>
      <div id="screenQuiz" class="hidden">
        <div class="word-big" id="qBase">ready?</div>
        <div class="small">í˜„ì¬í˜•ì— ë§ëŠ” <b>ì˜¬ë°”ë¥¸ ê³¼ê±°í˜•Â·ê³¼ê±°ë¶„ì‚¬ ì„¸íŠ¸</b>ë¥¼ ê³ ë¥´ì„¸ìš”.</div>
        <div class="qopts" id="opts"></div>
      </div>
    </div>

    <aside class="right">
      <div class="row">
        <button class="btn ghost" id="btnStartStudy">í•™ìŠµ ì‹œì‘</button>
        <button class="btn ghost" id="btnStartQuiz">í€´ì¦ˆ ì‹œì‘</button>
        <button class="btn ghost" id="btnNextSet">ë‹¤ìŒ ì„¸íŠ¸ â–¶</button>
      </div>
      <div>
        <div class="small">ìµœê·¼ ì •ë‹µ</div>
        <div id="history" class="row"></div>
      </div>
      <div>
        <div class="small">ì˜¤ë‹µ ëª©ë¡ (<span id="wcount">0</span>)</div>
        <div id="wrongs" class="row"></div>
      </div>
      <div class="small">ë‹¨ì¶•í‚¤: â£(ì½ê¸°/ì •ì§€), â†/â†’(ì´ì „/ë‹¤ìŒ), Q(í€´ì¦ˆì‹œì‘), S(í•™ìŠµì‹œì‘)</div>
    </aside>
  </div>

  <div class="footer">
    <div class="left">
      <button class="btn ghost" id="btnReset">ì´ˆê¸°í™”</button>
      <button class="btn ghost" id="btnWrongOnly">ì˜¤ë‹µë§Œ</button>
    </div>
  </div>
</div>

<div class="modal" id="modal"><div class="box">
  <h3 id="modalTitle">ì•Œë¦¼</h3><div id="modalBody" class="small"></div>
  <div class="row" style="margin-top:12px; justify-content:flex-end">
    <button class="btn secondary" id="btnModalClose">ë‹«ê¸°</button>
    <button class="btn" id="btnModalAction">í™•ì¸</button>
  </div>
</div></div>

<script>
const $=s=>document.querySelector(s);
const $$=s=>document.querySelectorAll(s);
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;};
const say=(txt,rate)=>{ if($("#mute").checked) return null; const u=new SpeechSynthesisUtterance(txt); u.lang="en-US"; u.rate=rate; speechSynthesis.speak(u); return u; };

const VERBS=[
  // ë¶ˆê·œì¹™ + ìì£¼ ì“°ëŠ” ê·œì¹™ ë™ì‚¬ (100+)
  {base:"be",past:"was/were",pp:"been",kr:"~ì´ë‹¤/ìˆë‹¤"},
  {base:"become",past:"became",pp:"become",kr:"~ì´ ë˜ë‹¤"},
  {base:"begin",past:"began",pp:"begun",kr:"ì‹œì‘í•˜ë‹¤"},
  {base:"break",past:"broke",pp:"broken",kr:"ê¹¨ë‹¤"},
  {base:"bring",past:"brought",pp:"brought",kr:"ê°€ì ¸ì˜¤ë‹¤"},
  {base:"build",past:"built",pp:"built",kr:"ì§“ë‹¤"},
  {base:"buy",past:"bought",pp:"bought",kr:"ì‚¬ë‹¤"},
  {base:"catch",past:"caught",pp:"caught",kr:"ì¡ë‹¤"},
  {base:"choose",past:"chose",pp:"chosen",kr:"ê³ ë¥´ë‹¤"},
  {base:"come",past:"came",pp:"come",kr:"ì˜¤ë‹¤"},
  {base:"cost",past:"cost",pp:"cost",kr:"ë¹„ìš©ì´ ë“¤ë‹¤"},
  {base:"cut",past:"cut",pp:"cut",kr:"ìë¥´ë‹¤"},
  {base:"do",past:"did",pp:"done",kr:"í•˜ë‹¤"},
  {base:"draw",past:"drew",pp:"drawn",kr:"ê·¸ë¦¬ë‹¤"},
  {base:"drink",past:"drank",pp:"drunk",kr:"ë§ˆì‹œë‹¤"},
  {base:"drive",past:"drove",pp:"driven",kr:"ìš´ì „í•˜ë‹¤"},
  {base:"eat",past:"ate",pp:"eaten",kr:"ë¨¹ë‹¤"},
  {base:"fall",past:"fell",pp:"fallen",kr:"ë–¨ì–´ì§€ë‹¤"},
  {base:"feel",past:"felt",pp:"felt",kr:"ëŠë¼ë‹¤"},
  {base:"fight",past:"fought",pp:"fought",kr:"ì‹¸ìš°ë‹¤"},
  {base:"find",past:"found",pp:"found",kr:"ì°¾ë‹¤"},
  {base:"fly",past:"flew",pp:"flown",kr:"ë‚ ë‹¤"},
  {base:"forget",past:"forgot",pp:"forgotten",kr:"ìŠë‹¤"},
  {base:"forgive",past:"forgave",pp:"forgiven",kr:"ìš©ì„œí•˜ë‹¤"},
  {base:"get",past:"got",pp:"got/gotten",kr:"ì–»ë‹¤/ë˜ë‹¤"},
  {base:"give",past:"gave",pp:"given",kr:"ì£¼ë‹¤"},
  {base:"go",past:"went",pp:"gone",kr:"ê°€ë‹¤"},
  {base:"grow",past:"grew",pp:"grown",kr:"ìë¼ë‹¤"},
  {base:"hang",past:"hung",pp:"hung",kr:"ê±¸ë‹¤"},
  {base:"have",past:"had",pp:"had",kr:"ê°€ì§€ë‹¤"},
  {base:"hear",past:"heard",pp:"heard",kr:"ë“£ë‹¤"},
  {base:"hide",past:"hid",pp:"hidden",kr:"ìˆ¨ë‹¤"},
  {base:"hit",past:"hit",pp:"hit",kr:"ì¹˜ë‹¤"},
  {base:"hold",past:"held",pp:"held",kr:"ì¡ë‹¤/ê°œìµœí•˜ë‹¤"},
  {base:"keep",past:"kept",pp:"kept",kr:"ì§€í‚¤ë‹¤/ìœ ì§€í•˜ë‹¤"},
  {base:"know",past:"knew",pp:"known",kr:"ì•Œë‹¤"},
  {base:"learn",past:"learned/learnt",pp:"learned/learnt",kr:"ë°°ìš°ë‹¤"},
  {base:"leave",past:"left",pp:"left",kr:"ë– ë‚˜ë‹¤/ë‚¨ê¸°ë‹¤"},
  {base:"lend",past:"lent",pp:"lent",kr:"ë¹Œë ¤ì£¼ë‹¤"},
  {base:"let",past:"let",pp:"let",kr:"~í•˜ê²Œ í•˜ë‹¤"},
  {base:"lose",past:"lost",pp:"lost",kr:"ìƒë‹¤"},
  {base:"make",past:"made",pp:"made",kr:"ë§Œë“¤ë‹¤"},
  {base:"meet",past:"met",pp:"met",kr:"ë§Œë‚˜ë‹¤"},
  {base:"pay",past:"paid",pp:"paid",kr:"ì§€ë¶ˆí•˜ë‹¤"},
  {base:"put",past:"put",pp:"put",kr:"ë†“ë‹¤"},
  {base:"read",past:"read",pp:"read",kr:"ì½ë‹¤(ë°œìŒ:red)"},
  {base:"ride",past:"rode",pp:"ridden",kr:"íƒ€ë‹¤"},
  {base:"ring",past:"rang",pp:"rung",kr:"ìš¸ë¦¬ë‹¤"},
  {base:"run",past:"ran",pp:"run",kr:"ë‹¬ë¦¬ë‹¤"},
  {base:"say",past:"said",pp:"said",kr:"ë§í•˜ë‹¤"},
  {base:"see",past:"saw",pp:"seen",kr:"ë³´ë‹¤"},
  {base:"sell",past:"sold",pp:"sold",kr:"íŒ”ë‹¤"},
  {base:"send",past:"sent",pp:"sent",kr:"ë³´ë‚´ë‹¤"},
  {base:"show",past:"showed",pp:"shown",kr:"ë³´ì—¬ì£¼ë‹¤"},
  {base:"sing",past:"sang",pp:"sung",kr:"ë…¸ë˜í•˜ë‹¤"},
  {base:"sit",past:"sat",pp:"sat",kr:"ì•‰ë‹¤"},
  {base:"sleep",past:"slept",pp:"slept",kr:"ìë‹¤"},
  {base:"speak",past:"spoke",pp:"spoken",kr:"ë§í•˜ë‹¤"},
  {base:"spend",past:"spent",pp:"spent",kr:"ì“°ë‹¤/ë³´ë‚´ë‹¤"},
  {base:"stand",past:"stood",pp:"stood",kr:"ì„œë‹¤"},
  {base:"swim",past:"swam",pp:"swum",kr:"ìˆ˜ì˜í•˜ë‹¤"},
  {base:"take",past:"took",pp:"taken",kr:"ê°€ì§€ê³  ê°€ë‹¤"},
  {base:"teach",past:"taught",pp:"taught",kr:"ê°€ë¥´ì¹˜ë‹¤"},
  {base:"tell",past:"told",pp:"told",kr:"ë§í•´ì£¼ë‹¤"},
  {base:"think",past:"thought",pp:"thought",kr:"ìƒê°í•˜ë‹¤"},
  {base:"understand",past:"understood",pp:"understood",kr:"ì´í•´í•˜ë‹¤"},
  {base:"wear",past:"wore",pp:"worn",kr:"ì…ë‹¤"},
  {base:"win",past:"won",pp:"won",kr:"ì´ê¸°ë‹¤"},
  {base:"write",past:"wrote",pp:"written",kr:"ì“°ë‹¤"},
  // ê·œì¹™/ê¸°ë³¸ í™œìš©ë„ ë†’ì€ ë™ì‚¬
  {base:"open",past:"opened",pp:"opened",kr:"ì—´ë‹¤"},
  {base:"close",past:"closed",pp:"closed",kr:"ë‹«ë‹¤"},
  {base:"play",past:"played",pp:"played",kr:"ë†€ë‹¤/ì—°ì£¼í•˜ë‹¤"},
  {base:"work",past:"worked",pp:"worked",kr:"ì¼í•˜ë‹¤"},
  {base:"study",past:"studied",pp:"studied",kr:"ê³µë¶€í•˜ë‹¤"},
  {base:"watch",past:"watched",pp:"watched",kr:"ë³´ë‹¤"},
  {base:"walk",past:"walked",pp:"walked",kr:"ê±·ë‹¤"},
  {base:"wash",past:"washed",pp:"washed",kr:"ì”»ë‹¤"},
  {base:"visit",past:"visited",pp:"visited",kr:"ë°©ë¬¸í•˜ë‹¤"},
  {base:"help",past:"helped",pp:"helped",kr:"ë•ë‹¤"},
  {base:"cook",past:"cooked",pp:"cooked",kr:"ìš”ë¦¬í•˜ë‹¤"},
  {base:"clean",past:"cleaned",pp:"cleaned",kr:"ì²­ì†Œí•˜ë‹¤"},
  {base:"move",past:"moved",pp:"moved",kr:"ì´ë™/ì´ì‚¬í•˜ë‹¤"},
  {base:"live",past:"lived",pp:"lived",kr:"ì‚´ë‹¤"},
  {base:"love",past:"loved",pp:"loved",kr:"ì‚¬ë‘í•˜ë‹¤"},
  {base:"need",past:"needed",pp:"needed",kr:"í•„ìš”í•˜ë‹¤"},
  {base:"call",past:"called",pp:"called",kr:"ì „í™”í•˜ë‹¤"},
  {base:"use",past:"used",pp:"used",kr:"ì‚¬ìš©í•˜ë‹¤"},
  {base:"finish",past:"finished",pp:"finished",kr:"ëë‚´ë‹¤"},
  {base:"plan",past:"planned",pp:"planned",kr:"ê³„íší•˜ë‹¤"},
  {base:"ask",past:"asked",pp:"asked",kr:"ë¬»ë‹¤/ìš”ì²­í•˜ë‹¤"},
  {base:"answer",past:"answered",pp:"answered",kr:"ë‹µí•˜ë‹¤"},
  {base:"start",past:"started",pp:"started",kr:"ì‹œì‘í•˜ë‹¤"},
  {base:"stop",past:"stopped",pp:"stopped",kr:"ë©ˆì¶”ë‹¤"},
  {base:"play",past:"played",pp:"played",kr:"ë†€ë‹¤/ì—°ì£¼í•˜ë‹¤"},
  {base:"practice",past:"practiced",pp:"practiced",kr:"ì—°ìŠµí•˜ë‹¤"},
  {base:"save",past:"saved",pp:"saved",kr:"ì €ì¶•/ì €ì¥í•˜ë‹¤"},
  {base:"borrow",past:"borrowed",pp:"borrowed",kr:"ë¹Œë¦¬ë‹¤"},
  {base:"visit",past:"visited",pp:"visited",kr:"ë°©ë¬¸í•˜ë‹¤"},
  {base:"travel",past:"traveled",pp:"traveled",kr:"ì—¬í–‰í•˜ë‹¤"},
  {base:"climb",past:"climbed",pp:"climbed",kr:"ì˜¤ë¥´ë‹¤"},
  {base:"paint",past:"painted",pp:"painted",kr:"ìƒ‰ì¹ í•˜ë‹¤"},
  {base:"dance",past:"danced",pp:"danced",kr:"ì¶¤ì¶”ë‹¤"},
  {base:"hope",past:"hoped",pp:"hoped",kr:"í¬ë§í•˜ë‹¤"},
  {base:"carry",past:"carried",pp:"carried",kr:"ë‚˜ë¥´ë‹¤"},
  {base:"cry",past:"cried",pp:"cried",kr:"ìš¸ë‹¤"},
  {base:"try",past:"tried",pp:"tried",kr:"ì‹œë„í•˜ë‹¤"},
  {base:"enjoy",past:"enjoyed",pp:"enjoyed",kr:"ì¦ê¸°ë‹¤"},
  {base:"decide",past:"decided",pp:"decided",kr:"ê²°ì •í•˜ë‹¤"},
  {base:"invite",past:"invited",pp:"invited",kr:"ì´ˆëŒ€í•˜ë‹¤"},
  {base:"visit",past:"visited",pp:"visited",kr:"ë°©ë¬¸í•˜ë‹¤"},
  {base:"mail",past:"mailed",pp:"mailed",kr:"ìš°í¸ ë³´ë‚´ë‹¤"},
  {base:"text",past:"texted",pp:"texted",kr:"ë¬¸ì ë³´ë‚´ë‹¤"},
  {base:"email",past:"emailed",pp:"emailed",kr:"ì´ë©”ì¼ ë³´ë‚´ë‹¤"},
  {base:"fix",past:"fixed",pp:"fixed",kr:"ê³ ì¹˜ë‹¤"},
  {base:"check",past:"checked",pp:"checked",kr:"í™•ì¸í•˜ë‹¤"},
  {base:"join",past:"joined",pp:"joined",kr:"ì°¸ê°€í•˜ë‹¤"},
  {base:"share",past:"shared",pp:"shared",kr:"ê³µìœ í•˜ë‹¤"},
  {base:"order",past:"ordered",pp:"ordered",kr:"ì£¼ë¬¸í•˜ë‹¤"},
  {base:"plant",past:"planted",pp:"planted",kr:"ì‹¬ë‹¤"}
];

let setSize=20,setIndex=0,currentSet=[],mode="study";
let iStudy=0, qi=0, ok=0, no=0, wrongList=[], history=[];

function updateStats(){
  const total=currentSet.length||0;
  const done=(mode==="quiz")?(ok+no):Math.min(iStudy,total);
  $("#ok").textContent=ok; $("#no").textContent=no;
  $("#left").textContent=Math.max(total-done,0);
  $("#progTxt").textContent=`${done}/${total}`;
  $("#bar").style.width=(total?(done/total*100):0)+"%";
  $("#wcount").textContent=wrongList.length;
}
function renderHistory(){
  const box=$("#history"); box.innerHTML="";
  history.slice(-12).reverse().forEach(v=>{
    const chip=document.createElement("span");
    chip.className="chip";
    chip.textContent=`${v.base} â€“ ${v.past} â€“ ${v.pp}`;
    chip.title=v.kr||"";
    chip.onclick=()=>speakTriple(v,parseFloat($("#rate").value),false);
    box.appendChild(chip);
  });
}
function renderWrongs(){
  const box=$("#wrongs"); box.innerHTML="";
  wrongList.slice(-20).forEach(v=>{
    const chip=document.createElement("span");
    chip.className="chip";
    chip.textContent=v.base;
    chip.title=`${v.base} â€“ ${v.past} â€“ ${v.pp}`;
    chip.onclick=()=>speakTriple(v,parseFloat($("#rate").value),false);
    box.appendChild(chip);
  });
}

function buildSets(){
  setSize=parseInt($("#setSize").value,10)||20;
  let list=shuffle(VERBS.slice());
  const total=Math.ceil(list.length/setSize)||1;
  if(setIndex>=total) setIndex=0;
  $("#setIdx").textContent=setIndex+1; $("#setTotal").textContent=total;
  currentSet=list.slice(setIndex*setSize,setIndex*setSize+setSize);
  iStudy=0; ok=0; no=0; qi=0; wrongList=[]; history=[];
  showStudyCard(); updateStats(); renderWrongs(); renderHistory();
}

function showStudyCard(){
  $("#promptTag").textContent="í•™ìŠµ ì¹´ë“œ";
  if(!currentSet.length){$("#bWord").textContent="(ë¹ˆ ì„¸íŠ¸)"; $("#krMeaning").textContent="ëœ»: -"; return;}
  const v=currentSet[iStudy]||currentSet[currentSet.length-1];
  $("#bWord").textContent=v.base;
  $("#pBase").textContent=v.base; $("#pPast").textContent=v.past; $("#pPP").textContent=v.pp;
  $("#krMeaning").textContent="ëœ»: "+(v.kr||"-");
}

function speakTriple(v,rate=1.0,autoMove=false){
  speechSynthesis.cancel();
  const arr=[{el:"#pBase",txt:v.base},{el:"#pPast",txt:v.past},{el:"#pPP",txt:v.pp}];
  let idx=0;
  const speakOne=()=>{
    if(idx>=arr.length){
      if(autoMove || $("#autoNext").checked){
        iStudy++; if(iStudy>=currentSet.length) { onStudyComplete(); } else { showStudyCard(); }
        updateStats();
      }
      return;
    }
    const {el,txt}=arr[idx];
    if(!$("#mute").checked){
      const u=new SpeechSynthesisUtterance(txt);
      u.lang="en-US"; u.rate=rate; u.volume=1.0;
      u.onstart=()=>{$$(".pill").forEach(p=>p.classList.remove("hl")); $(el).classList.add("hl");};
      u.onend=()=>{ $(el).classList.remove("hl"); idx++; speakOne(); };
      speechSynthesis.speak(u);
    } else {
      // ìŒì†Œê±° ì‹œ í•˜ì´ë¼ì´íŠ¸ë§Œ ìˆœì°¨ì ìœ¼ë¡œ
      $$(".pill").forEach(p=>p.classList.remove("hl")); $(el).classList.add("hl");
      setTimeout(()=>{ $(el).classList.remove("hl"); idx++; speakOne(); }, 250);
    }
  };
  speakOne();
}
function onStudyComplete(){
  showModal("ìˆ˜ê³ í–ˆì–´ìš”!","í•™ìŠµ ì„¸íŠ¸ê°€ ëë‚¬ì–´ìš”. í€´ì¦ˆë¡œ í™•ì¸í•´ë³¼ê¹Œìš”?","í€´ì¦ˆ ì‹œì‘",()=>{
    setMode("quiz"); startQuizFresh();
  });
}

function makeOptions(v){
  // ì •ë‹µ 1 + ë‹¤ë¥¸ ë™ì‚¬ 3ê°œì—ì„œ past/ppë§Œ ì„ì–´ ë³´ê¸° êµ¬ì„±
  const pool = shuffle(VERBS.filter(x=>x.base!==v.base)).slice(0,6);
  const distracts = shuffle(pool).slice(0,3).map(x=>({base:v.base,past:x.past,pp:x.pp,ok:false}));
  const correct = {base:v.base,past:v.past,pp:v.pp,ok:true};
  return shuffle([correct, ...distracts]);
}
function showQuizCard(){
  $("#promptTag").textContent="í€´ì¦ˆ";
  const box=$("#opts"); box.innerHTML="";
  if(!currentSet.length){$("#qBase").textContent="(ë¹ˆ ì„¸íŠ¸)"; return;}
  if(qi>=currentSet.length){
    showModal("ì„¸íŠ¸ ì™„ë£Œ!",`${ok} ì •ë‹µ Â· ${no} ì˜¤ë‹µ`,"ë‹¤ìŒ ì„¸íŠ¸",()=>{
      setIndex++; buildSets(); setMode("quiz"); hideModal();
    });
    return;
  }
  const v=currentSet[qi];
  $("#qBase").textContent=v.base;
  makeOptions(v).forEach(o=>{
    const d=document.createElement("div");
    d.className="opt";
    d.innerHTML=`<div class="t">${o.base} â€“ ${o.past} â€“ ${o.pp}</div>`;
    d.onclick=()=>{
      if(o.ok){ ok++; history.push(v); }
      else { no++; wrongList.push(v); }
      qi++; renderWrongs(); renderHistory(); showQuizCard(); updateStats();
    };
    box.appendChild(d);
  });
  updateStats();
}

function setMode(m){
  mode=m;
  if(m==="study"){
    $("#screenStudy").classList.remove("hidden");
    $("#screenQuiz").classList.add("hidden");
    $("#promptTag").textContent="í•™ìŠµ ì¹´ë“œ";
  }else{
    $("#screenQuiz").classList.remove("hidden");
    $("#screenStudy").classList.add("hidden");
    $("#promptTag").textContent="í€´ì¦ˆ";
  }
  updateStats();
}
function startQuizFresh(){ qi=0; ok=0; no=0; wrongList=[]; renderWrongs(); renderHistory(); showQuizCard(); }

function showModal(t,b,a,f){
  $("#modalTitle").textContent=t; $("#modalBody").innerHTML=b;
  $("#btnModalAction").textContent=a||"í™•ì¸";
  $("#btnModalAction").onclick=()=>{ if(f)f(); hideModal(); };
  $("#btnModalClose").onclick=hideModal;
  $("#modal").classList.add("show");
}
function hideModal(){ $("#modal").classList.remove("show"); }

// ì´ë²¤íŠ¸ ë°”ì¸ë”©
$("#btnPlay").onclick=()=>{ if(currentSet.length) speakTriple(currentSet[iStudy],parseFloat($("#rate").value),false); };
$("#btnRepeat").onclick=()=>{ if(currentSet.length) speakTriple(currentSet[iStudy],parseFloat($("#rate").value),true); };
$("#btnStop").onclick=()=>speechSynthesis.cancel();
$("#btnNext").onclick=()=>{ speechSynthesis.cancel(); iStudy++; if(iStudy>=currentSet.length) onStudyComplete(); else showStudyCard(); updateStats(); };
$("#btnPrev").onclick=()=>{ speechSynthesis.cancel(); iStudy=Math.max(iStudy-1,0); showStudyCard(); updateStats(); };
$("#btnStartStudy").onclick=()=>{
  setMode("study");
  iStudy=0;
  showStudyCard();
  updateStats();
  // ì‹œì‘ ì¦‰ì‹œ ì½ê¸° (ìë™ë‹¤ìŒ ì²´í¬ ì‹œ ìë™ ì§„í–‰)
  if(currentSet.length){
    speakTriple(currentSet[iStudy], parseFloat($("#rate").value), $("#autoNext").checked);
  }
};
$("#btnStartQuiz").onclick=()=>startQuizFresh();
$("#btnNextSet").onclick=()=>{ setIndex++; buildSets(); setMode($("#mode").value); };
$("#btnReset").onclick=()=>{ setIndex=0; buildSets(); setMode("study"); };
$("#btnWrongOnly").onclick=()=>{ if(!wrongList.length){ alert("ì˜¤ë‹µ ì—†ìŒ"); return; }
  currentSet=shuffle(wrongList.slice()); wrongList=[]; ok=0; no=0; qi=0; setMode("quiz"); showQuizCard(); renderWrongs(); updateStats(); };

$("#mode").addEventListener("change",e=>setMode(e.target.value));
$("#setSize").addEventListener("change",()=>{ buildSets(); setMode($("#mode").value); });

// ë‹¨ì¶•í‚¤
window.addEventListener("keydown",(e)=>{
  if(e.target.tagName==="INPUT" || e.target.tagName==="SELECT") return;
  if(e.code==="Space"){ e.preventDefault(); if(speechSynthesis.speaking) speechSynthesis.cancel(); else if(mode==="study") $("#btnPlay").click(); }
  if(e.key==="ArrowRight"){ $("#btnNext").click(); }
  if(e.key==="ArrowLeft"){ $("#btnPrev").click(); }
  if(e.key.toLowerCase()==="q"){ $("#btnStartQuiz").click(); }
  if(e.key.toLowerCase()==="s"){ $("#btnStartStudy").click(); }
});

window.addEventListener("DOMContentLoaded",()=>{ buildSets(); setMode("study"); });
</script>
</body>
</html>

