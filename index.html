<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>동사 변형 학습 & 4지선다 퀴즈</title>
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --panel:#1f2937; --text:#e5e7eb; --muted:#9ca3af;
      --blue:#3b82f6; --green:#22c55e; --red:#ef4444; --amber:#f59e0b;
      --radius:16px; --shadow:0 6px 18px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box;}
    body{margin:0; font-family:"Noto Sans KR",system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
      background:var(--bg); color:var(--text); min-height:100vh; display:flex; align-items:center; justify-content:center;}
    .app{width:min(1000px,94vw); height:min(760px,94vh); display:grid; gap:12px; grid-template-rows:auto auto 1fr auto;}
    .topbar{display:flex; justify-content:space-between; align-items:center;}
    .brand{font-weight:800; font-size:20px;}
    .stats{font-size:14px; color:var(--muted);}
    .panel{background:var(--panel); border-radius:var(--radius); box-shadow:var(--shadow); padding:12px;}
    .controls{display:grid; grid-template-columns:repeat(6,1fr); gap:8px;}
    .controls label{font-size:12px; color:var(--muted);}
    .controls select,.controls input[type="range"],.controls input[type="checkbox"]{width:100%; background:#0b1220; color:var(--text); border:1px solid #263247; border-radius:10px; padding:6px;}
    .progress{display:flex; align-items:center; gap:10px; margin-top:10px;}
    .bar{flex:1; height:12px; background:#0b1220; border:1px solid #263247; border-radius:999px; overflow:hidden;}
    .bar>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,#2563eb,#22c55e);}
    .screens{display:flex; gap:12px;}
    .card{flex:1; background:var(--card); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow); text-align:center;}
    .prompt-tag{font-size:12px; color:var(--muted); border:1px dashed #334155; padding:2px 8px; border-radius:999px; margin-bottom:8px; display:inline-block;}
    .word-big{font-size:56px; font-weight:900; margin:8px 0 6px; line-height:1.05;}
    .mean{margin-top:6px; font-size:22px; color:#e2e8f0;}
    .triple{display:flex; gap:10px; justify-content:center; margin:10px 0; flex-wrap:wrap;}
    .pill{padding:10px 16px; border-radius:999px; background:#0b1220; border:1px solid #2a3650; font-weight:800; font-size:20px;}
    .pill.hl{outline:2px solid var(--blue);}
    .btn{border:0; border-radius:14px; padding:12px 16px; font-weight:700; cursor:pointer; background:var(--blue); color:white;}
    .btn.secondary{background:#0b1220; color:var(--text); border:1px solid #2a3650;}
    .btn.warn{background:var(--amber);}
    .btn.ghost{background:transparent; border:1px dashed #334155; color:var(--muted);}
    .right{width:320px; background:var(--card); border-radius:var(--radius); padding:14px; display:flex; flex-direction:column; gap:12px;}
    .chip{font-size:12px; color:#d1d5db; padding:6px 10px; border-radius:999px; background:#0b1220; border:1px solid #2a3650; cursor:pointer;}
    .small{font-size:12px; color:var(--muted);}
    .qopts{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;}
    .opt{background:#0b1220; border:1px solid #2a3650; border-radius:14px; padding:14px; cursor:pointer; text-align:left;}
    .opt .t{font-size:18px; font-weight:800;}
    .footer{display:flex; justify-content:space-between; align-items:center;}
    .row{display:flex; gap:8px; flex-wrap:wrap;}
    .hidden{display:none !important;}
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.5);}
    .modal.show{display:flex;}
    .modal .box{background:var(--panel); border-radius:20px; padding:20px; width:min(560px,92vw);}
    @media (max-width:960px){ .screens{flex-direction:column;} .right{width:100%; order:2} .card{order:1} }
  </style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="brand">동사 변형 학습 · 4지선다 퀴즈</div>
    <div class="stats">
      🔊 <label><input type="checkbox" id="mute"/> 음소거</label> ·
      정답 <span id="ok">0</span> · 오답 <span id="no">0</span> · 남은 <span id="left">0</span> ·
      세트 <span id="setIdx">1</span>/<span id="setTotal">1</span>
    </div>
  </div>

  <div class="panel">
    <div class="controls">
      <div><label>모드</label>
        <select id="mode"><option value="study">학습</option><option value="quiz">퀴즈</option></select>
      </div>
      <div><label>세트 크기</label>
        <select id="setSize">
          <option value="10">10</option><option value="20" selected>20</option><option value="30">30</option><option value="40">40</option>
        </select>
      </div>
      <div><label>속도</label>
        <input type="range" id="rate" min="0.8" max="1.2" step="0.05" value="1.0"/>
      </div>
      <div><label><input type="checkbox" id="autoNext"/> 자동 다음</label></div>
      <div></div><div></div>
    </div>
    <div class="progress"><div class="bar"><i id="bar"></i></div><div class="small"><span id="progTxt">0/0</span></div></div>
  </div>

  <div class="screens">
    <div class="card">
      <div class="prompt-tag" id="promptTag">학습 카드</div>
      <div id="screenStudy">
        <div class="word-big" id="bWord">ready?</div>
        <div class="mean" id="krMeaning">뜻: -</div>
        <div class="triple">
          <span class="pill" id="pBase">base</span>
          <span class="pill" id="pPast">past</span>
          <span class="pill" id="pPP">pp</span>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="btnPlay">▶ 읽기</button>
          <button class="btn secondary" id="btnRepeat">⟳ 반복+자동</button>
          <button class="btn secondary" id="btnStop">◼ 정지</button>
          <button class="btn warn" id="btnNext">다음</button>
          <button class="btn ghost" id="btnPrev">이전</button>
        </div>
      </div>
      <div id="screenQuiz" class="hidden">
        <div class="word-big" id="qBase">ready?</div>
        <div class="small">현재형에 맞는 <b>올바른 과거형·과거분사 세트</b>를 고르세요.</div>
        <div class="qopts" id="opts"></div>
      </div>
    </div>

    <aside class="right">
      <div class="row">
        <button class="btn ghost" id="btnStartStudy">학습 시작</button>
        <button class="btn ghost" id="btnStartQuiz">퀴즈 시작</button>
        <button class="btn ghost" id="btnNextSet">다음 세트 ▶</button>
      </div>
      <div>
        <div class="small">최근 정답</div>
        <div id="history" class="row"></div>
      </div>
      <div>
        <div class="small">오답 목록 (<span id="wcount">0</span>)</div>
        <div id="wrongs" class="row"></div>
      </div>
      <div class="small">단축키: ␣(읽기/정지), ←/→(이전/다음), Q(퀴즈시작), S(학습시작)</div>
    </aside>
  </div>

  <div class="footer">
    <div class="left">
      <button class="btn ghost" id="btnReset">초기화</button>
      <button class="btn ghost" id="btnWrongOnly">오답만</button>
    </div>
  </div>
</div>

<div class="modal" id="modal"><div class="box">
  <h3 id="modalTitle">알림</h3><div id="modalBody" class="small"></div>
  <div class="row" style="margin-top:12px; justify-content:flex-end">
    <button class="btn secondary" id="btnModalClose">닫기</button>
    <button class="btn" id="btnModalAction">확인</button>
  </div>
</div></div>

<script>
const $=s=>document.querySelector(s);
const $$=s=>document.querySelectorAll(s);
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;};
const say=(txt,rate)=>{ if($("#mute").checked) return null; const u=new SpeechSynthesisUtterance(txt); u.lang="en-US"; u.rate=rate; speechSynthesis.speak(u); return u; };

const VERBS=[
  // 불규칙 + 자주 쓰는 규칙 동사 (100+)
  {base:"be",past:"was/were",pp:"been",kr:"~이다/있다"},
  {base:"become",past:"became",pp:"become",kr:"~이 되다"},
  {base:"begin",past:"began",pp:"begun",kr:"시작하다"},
  {base:"break",past:"broke",pp:"broken",kr:"깨다"},
  {base:"bring",past:"brought",pp:"brought",kr:"가져오다"},
  {base:"build",past:"built",pp:"built",kr:"짓다"},
  {base:"buy",past:"bought",pp:"bought",kr:"사다"},
  {base:"catch",past:"caught",pp:"caught",kr:"잡다"},
  {base:"choose",past:"chose",pp:"chosen",kr:"고르다"},
  {base:"come",past:"came",pp:"come",kr:"오다"},
  {base:"cost",past:"cost",pp:"cost",kr:"비용이 들다"},
  {base:"cut",past:"cut",pp:"cut",kr:"자르다"},
  {base:"do",past:"did",pp:"done",kr:"하다"},
  {base:"draw",past:"drew",pp:"drawn",kr:"그리다"},
  {base:"drink",past:"drank",pp:"drunk",kr:"마시다"},
  {base:"drive",past:"drove",pp:"driven",kr:"운전하다"},
  {base:"eat",past:"ate",pp:"eaten",kr:"먹다"},
  {base:"fall",past:"fell",pp:"fallen",kr:"떨어지다"},
  {base:"feel",past:"felt",pp:"felt",kr:"느끼다"},
  {base:"fight",past:"fought",pp:"fought",kr:"싸우다"},
  {base:"find",past:"found",pp:"found",kr:"찾다"},
  {base:"fly",past:"flew",pp:"flown",kr:"날다"},
  {base:"forget",past:"forgot",pp:"forgotten",kr:"잊다"},
  {base:"forgive",past:"forgave",pp:"forgiven",kr:"용서하다"},
  {base:"get",past:"got",pp:"got/gotten",kr:"얻다/되다"},
  {base:"give",past:"gave",pp:"given",kr:"주다"},
  {base:"go",past:"went",pp:"gone",kr:"가다"},
  {base:"grow",past:"grew",pp:"grown",kr:"자라다"},
  {base:"hang",past:"hung",pp:"hung",kr:"걸다"},
  {base:"have",past:"had",pp:"had",kr:"가지다"},
  {base:"hear",past:"heard",pp:"heard",kr:"듣다"},
  {base:"hide",past:"hid",pp:"hidden",kr:"숨다"},
  {base:"hit",past:"hit",pp:"hit",kr:"치다"},
  {base:"hold",past:"held",pp:"held",kr:"잡다/개최하다"},
  {base:"keep",past:"kept",pp:"kept",kr:"지키다/유지하다"},
  {base:"know",past:"knew",pp:"known",kr:"알다"},
  {base:"learn",past:"learned/learnt",pp:"learned/learnt",kr:"배우다"},
  {base:"leave",past:"left",pp:"left",kr:"떠나다/남기다"},
  {base:"lend",past:"lent",pp:"lent",kr:"빌려주다"},
  {base:"let",past:"let",pp:"let",kr:"~하게 하다"},
  {base:"lose",past:"lost",pp:"lost",kr:"잃다"},
  {base:"make",past:"made",pp:"made",kr:"만들다"},
  {base:"meet",past:"met",pp:"met",kr:"만나다"},
  {base:"pay",past:"paid",pp:"paid",kr:"지불하다"},
  {base:"put",past:"put",pp:"put",kr:"놓다"},
  {base:"read",past:"read",pp:"read",kr:"읽다(발음:red)"},
  {base:"ride",past:"rode",pp:"ridden",kr:"타다"},
  {base:"ring",past:"rang",pp:"rung",kr:"울리다"},
  {base:"run",past:"ran",pp:"run",kr:"달리다"},
  {base:"say",past:"said",pp:"said",kr:"말하다"},
  {base:"see",past:"saw",pp:"seen",kr:"보다"},
  {base:"sell",past:"sold",pp:"sold",kr:"팔다"},
  {base:"send",past:"sent",pp:"sent",kr:"보내다"},
  {base:"show",past:"showed",pp:"shown",kr:"보여주다"},
  {base:"sing",past:"sang",pp:"sung",kr:"노래하다"},
  {base:"sit",past:"sat",pp:"sat",kr:"앉다"},
  {base:"sleep",past:"slept",pp:"slept",kr:"자다"},
  {base:"speak",past:"spoke",pp:"spoken",kr:"말하다"},
  {base:"spend",past:"spent",pp:"spent",kr:"쓰다/보내다"},
  {base:"stand",past:"stood",pp:"stood",kr:"서다"},
  {base:"swim",past:"swam",pp:"swum",kr:"수영하다"},
  {base:"take",past:"took",pp:"taken",kr:"가지고 가다"},
  {base:"teach",past:"taught",pp:"taught",kr:"가르치다"},
  {base:"tell",past:"told",pp:"told",kr:"말해주다"},
  {base:"think",past:"thought",pp:"thought",kr:"생각하다"},
  {base:"understand",past:"understood",pp:"understood",kr:"이해하다"},
  {base:"wear",past:"wore",pp:"worn",kr:"입다"},
  {base:"win",past:"won",pp:"won",kr:"이기다"},
  {base:"write",past:"wrote",pp:"written",kr:"쓰다"},
  // 규칙/기본 활용도 높은 동사
  {base:"open",past:"opened",pp:"opened",kr:"열다"},
  {base:"close",past:"closed",pp:"closed",kr:"닫다"},
  {base:"play",past:"played",pp:"played",kr:"놀다/연주하다"},
  {base:"work",past:"worked",pp:"worked",kr:"일하다"},
  {base:"study",past:"studied",pp:"studied",kr:"공부하다"},
  {base:"watch",past:"watched",pp:"watched",kr:"보다"},
  {base:"walk",past:"walked",pp:"walked",kr:"걷다"},
  {base:"wash",past:"washed",pp:"washed",kr:"씻다"},
  {base:"visit",past:"visited",pp:"visited",kr:"방문하다"},
  {base:"help",past:"helped",pp:"helped",kr:"돕다"},
  {base:"cook",past:"cooked",pp:"cooked",kr:"요리하다"},
  {base:"clean",past:"cleaned",pp:"cleaned",kr:"청소하다"},
  {base:"move",past:"moved",pp:"moved",kr:"이동/이사하다"},
  {base:"live",past:"lived",pp:"lived",kr:"살다"},
  {base:"love",past:"loved",pp:"loved",kr:"사랑하다"},
  {base:"need",past:"needed",pp:"needed",kr:"필요하다"},
  {base:"call",past:"called",pp:"called",kr:"전화하다"},
  {base:"use",past:"used",pp:"used",kr:"사용하다"},
  {base:"finish",past:"finished",pp:"finished",kr:"끝내다"},
  {base:"plan",past:"planned",pp:"planned",kr:"계획하다"},
  {base:"ask",past:"asked",pp:"asked",kr:"묻다/요청하다"},
  {base:"answer",past:"answered",pp:"answered",kr:"답하다"},
  {base:"start",past:"started",pp:"started",kr:"시작하다"},
  {base:"stop",past:"stopped",pp:"stopped",kr:"멈추다"},
  {base:"play",past:"played",pp:"played",kr:"놀다/연주하다"},
  {base:"practice",past:"practiced",pp:"practiced",kr:"연습하다"},
  {base:"save",past:"saved",pp:"saved",kr:"저축/저장하다"},
  {base:"borrow",past:"borrowed",pp:"borrowed",kr:"빌리다"},
  {base:"visit",past:"visited",pp:"visited",kr:"방문하다"},
  {base:"travel",past:"traveled",pp:"traveled",kr:"여행하다"},
  {base:"climb",past:"climbed",pp:"climbed",kr:"오르다"},
  {base:"paint",past:"painted",pp:"painted",kr:"색칠하다"},
  {base:"dance",past:"danced",pp:"danced",kr:"춤추다"},
  {base:"hope",past:"hoped",pp:"hoped",kr:"희망하다"},
  {base:"carry",past:"carried",pp:"carried",kr:"나르다"},
  {base:"cry",past:"cried",pp:"cried",kr:"울다"},
  {base:"try",past:"tried",pp:"tried",kr:"시도하다"},
  {base:"enjoy",past:"enjoyed",pp:"enjoyed",kr:"즐기다"},
  {base:"decide",past:"decided",pp:"decided",kr:"결정하다"},
  {base:"invite",past:"invited",pp:"invited",kr:"초대하다"},
  {base:"visit",past:"visited",pp:"visited",kr:"방문하다"},
  {base:"mail",past:"mailed",pp:"mailed",kr:"우편 보내다"},
  {base:"text",past:"texted",pp:"texted",kr:"문자 보내다"},
  {base:"email",past:"emailed",pp:"emailed",kr:"이메일 보내다"},
  {base:"fix",past:"fixed",pp:"fixed",kr:"고치다"},
  {base:"check",past:"checked",pp:"checked",kr:"확인하다"},
  {base:"join",past:"joined",pp:"joined",kr:"참가하다"},
  {base:"share",past:"shared",pp:"shared",kr:"공유하다"},
  {base:"order",past:"ordered",pp:"ordered",kr:"주문하다"},
  {base:"plant",past:"planted",pp:"planted",kr:"심다"}
];

let setSize=20,setIndex=0,currentSet=[],mode="study";
let iStudy=0, qi=0, ok=0, no=0, wrongList=[], history=[];

function updateStats(){
  const total=currentSet.length||0;
  const done=(mode==="quiz")?(ok+no):Math.min(iStudy,total);
  $("#ok").textContent=ok; $("#no").textContent=no;
  $("#left").textContent=Math.max(total-done,0);
  $("#progTxt").textContent=`${done}/${total}`;
  $("#bar").style.width=(total?(done/total*100):0)+"%";
  $("#wcount").textContent=wrongList.length;
}
function renderHistory(){
  const box=$("#history"); box.innerHTML="";
  history.slice(-12).reverse().forEach(v=>{
    const chip=document.createElement("span");
    chip.className="chip";
    chip.textContent=`${v.base} – ${v.past} – ${v.pp}`;
    chip.title=v.kr||"";
    chip.onclick=()=>speakTriple(v,parseFloat($("#rate").value),false);
    box.appendChild(chip);
  });
}
function renderWrongs(){
  const box=$("#wrongs"); box.innerHTML="";
  wrongList.slice(-20).forEach(v=>{
    const chip=document.createElement("span");
    chip.className="chip";
    chip.textContent=v.base;
    chip.title=`${v.base} – ${v.past} – ${v.pp}`;
    chip.onclick=()=>speakTriple(v,parseFloat($("#rate").value),false);
    box.appendChild(chip);
  });
}

function buildSets(){
  setSize=parseInt($("#setSize").value,10)||20;
  let list=shuffle(VERBS.slice());
  const total=Math.ceil(list.length/setSize)||1;
  if(setIndex>=total) setIndex=0;
  $("#setIdx").textContent=setIndex+1; $("#setTotal").textContent=total;
  currentSet=list.slice(setIndex*setSize,setIndex*setSize+setSize);
  iStudy=0; ok=0; no=0; qi=0; wrongList=[]; history=[];
  showStudyCard(); updateStats(); renderWrongs(); renderHistory();
}

function showStudyCard(){
  $("#promptTag").textContent="학습 카드";
  if(!currentSet.length){$("#bWord").textContent="(빈 세트)"; $("#krMeaning").textContent="뜻: -"; return;}
  const v=currentSet[iStudy]||currentSet[currentSet.length-1];
  $("#bWord").textContent=v.base;
  $("#pBase").textContent=v.base; $("#pPast").textContent=v.past; $("#pPP").textContent=v.pp;
  $("#krMeaning").textContent="뜻: "+(v.kr||"-");
}

function speakTriple(v,rate=1.0,autoMove=false){
  speechSynthesis.cancel();
  const arr=[{el:"#pBase",txt:v.base},{el:"#pPast",txt:v.past},{el:"#pPP",txt:v.pp}];
  let idx=0;
  const speakOne=()=>{
    if(idx>=arr.length){
      if(autoMove || $("#autoNext").checked){
        iStudy++; if(iStudy>=currentSet.length) { onStudyComplete(); } else { showStudyCard(); }
        updateStats();
      }
      return;
    }
    const {el,txt}=arr[idx];
    if(!$("#mute").checked){
      const u=new SpeechSynthesisUtterance(txt);
      u.lang="en-US"; u.rate=rate; u.volume=1.0;
      u.onstart=()=>{$$(".pill").forEach(p=>p.classList.remove("hl")); $(el).classList.add("hl");};
      u.onend=()=>{ $(el).classList.remove("hl"); idx++; speakOne(); };
      speechSynthesis.speak(u);
    } else {
      // 음소거 시 하이라이트만 순차적으로
      $$(".pill").forEach(p=>p.classList.remove("hl")); $(el).classList.add("hl");
      setTimeout(()=>{ $(el).classList.remove("hl"); idx++; speakOne(); }, 250);
    }
  };
  speakOne();
}
function onStudyComplete(){
  showModal("수고했어요!","학습 세트가 끝났어요. 퀴즈로 확인해볼까요?","퀴즈 시작",()=>{
    setMode("quiz"); startQuizFresh();
  });
}

function makeOptions(v){
  // 정답 1 + 다른 동사 3개에서 past/pp만 섞어 보기 구성
  const pool = shuffle(VERBS.filter(x=>x.base!==v.base)).slice(0,6);
  const distracts = shuffle(pool).slice(0,3).map(x=>({base:v.base,past:x.past,pp:x.pp,ok:false}));
  const correct = {base:v.base,past:v.past,pp:v.pp,ok:true};
  return shuffle([correct, ...distracts]);
}
function showQuizCard(){
  $("#promptTag").textContent="퀴즈";
  const box=$("#opts"); box.innerHTML="";
  if(!currentSet.length){$("#qBase").textContent="(빈 세트)"; return;}
  if(qi>=currentSet.length){
    showModal("세트 완료!",`${ok} 정답 · ${no} 오답`,"다음 세트",()=>{
      setIndex++; buildSets(); setMode("quiz"); hideModal();
    });
    return;
  }
  const v=currentSet[qi];
  $("#qBase").textContent=v.base;
  makeOptions(v).forEach(o=>{
    const d=document.createElement("div");
    d.className="opt";
    d.innerHTML=`<div class="t">${o.base} – ${o.past} – ${o.pp}</div>`;
    d.onclick=()=>{
      if(o.ok){ ok++; history.push(v); }
      else { no++; wrongList.push(v); }
      qi++; renderWrongs(); renderHistory(); showQuizCard(); updateStats();
    };
    box.appendChild(d);
  });
  updateStats();
}

function setMode(m){
  mode=m;
  if(m==="study"){
    $("#screenStudy").classList.remove("hidden");
    $("#screenQuiz").classList.add("hidden");
    $("#promptTag").textContent="학습 카드";
  }else{
    $("#screenQuiz").classList.remove("hidden");
    $("#screenStudy").classList.add("hidden");
    $("#promptTag").textContent="퀴즈";
  }
  updateStats();
}
function startQuizFresh(){ qi=0; ok=0; no=0; wrongList=[]; renderWrongs(); renderHistory(); showQuizCard(); }

function showModal(t,b,a,f){
  $("#modalTitle").textContent=t; $("#modalBody").innerHTML=b;
  $("#btnModalAction").textContent=a||"확인";
  $("#btnModalAction").onclick=()=>{ if(f)f(); hideModal(); };
  $("#btnModalClose").onclick=hideModal;
  $("#modal").classList.add("show");
}
function hideModal(){ $("#modal").classList.remove("show"); }

// 이벤트 바인딩
$("#btnPlay").onclick=()=>{ if(currentSet.length) speakTriple(currentSet[iStudy],parseFloat($("#rate").value),false); };
$("#btnRepeat").onclick=()=>{ if(currentSet.length) speakTriple(currentSet[iStudy],parseFloat($("#rate").value),true); };
$("#btnStop").onclick=()=>speechSynthesis.cancel();
$("#btnNext").onclick=()=>{ speechSynthesis.cancel(); iStudy++; if(iStudy>=currentSet.length) onStudyComplete(); else showStudyCard(); updateStats(); };
$("#btnPrev").onclick=()=>{ speechSynthesis.cancel(); iStudy=Math.max(iStudy-1,0); showStudyCard(); updateStats(); };
$("#btnStartStudy").onclick=()=>{
  setMode("study");
  iStudy=0;
  showStudyCard();
  updateStats();
  // 시작 즉시 읽기 (자동다음 체크 시 자동 진행)
  if(currentSet.length){
    speakTriple(currentSet[iStudy], parseFloat($("#rate").value), $("#autoNext").checked);
  }
};
$("#btnStartQuiz").onclick=()=>startQuizFresh();
$("#btnNextSet").onclick=()=>{ setIndex++; buildSets(); setMode($("#mode").value); };
$("#btnReset").onclick=()=>{ setIndex=0; buildSets(); setMode("study"); };
$("#btnWrongOnly").onclick=()=>{ if(!wrongList.length){ alert("오답 없음"); return; }
  currentSet=shuffle(wrongList.slice()); wrongList=[]; ok=0; no=0; qi=0; setMode("quiz"); showQuizCard(); renderWrongs(); updateStats(); };

$("#mode").addEventListener("change",e=>setMode(e.target.value));
$("#setSize").addEventListener("change",()=>{ buildSets(); setMode($("#mode").value); });

// 단축키
window.addEventListener("keydown",(e)=>{
  if(e.target.tagName==="INPUT" || e.target.tagName==="SELECT") return;
  if(e.code==="Space"){ e.preventDefault(); if(speechSynthesis.speaking) speechSynthesis.cancel(); else if(mode==="study") $("#btnPlay").click(); }
  if(e.key==="ArrowRight"){ $("#btnNext").click(); }
  if(e.key==="ArrowLeft"){ $("#btnPrev").click(); }
  if(e.key.toLowerCase()==="q"){ $("#btnStartQuiz").click(); }
  if(e.key.toLowerCase()==="s"){ $("#btnStartStudy").click(); }
});

window.addEventListener("DOMContentLoaded",()=>{ buildSets(); setMode("study"); });
</script>
</body>
</html>

